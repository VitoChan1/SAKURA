---
title: "Make run summary plots"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(ggplot2)
require(dplyr)
require(magrittr)
options(stringsAsFactors = FALSE)
getwd()
```

# Configuration

```{r paths}
emb_path <- './runs/EX04_05/logs'
pheno_df_path <- './dataset/PUMC_mouse_cardio/TAC_cell_info_191024.csv'
expr_mat_path <- './dataset/PUMC_mouse_cardio/TAC_cell_umi_191024.csv'
expr_mat_SCT_path <- './dataset/PUMC_mouse_cardio/sctransform_poission_res.csv.gz'
```

# Import Labels

```{r import labels}
pheno_df <- read.csv(pheno_df_path)
expr_mat <- read.csv(expr_mat_path)
expr_sct_mat <- read.csv(expr_mat_SCT_path)
```

# Make Embedding Plots

```{r global configs}
total_epochs <- 120
```

## Main latent plots (main.1 and main.2)


```{r main latent plots}
try({
      keys_to_plot <- c("bigClass_train_all_latent", "bigClass_test_all_latent") # c("all_cell_all_latent", "overall_test_all_latent", "overall_train_all_latent")
      output_width <- 5
      output_height <- 5
      for (i in 1:total_epochs) {
        for (cur_key in keys_to_plot) {
          emb_filename <- paste0(emb_path, '/', i, '_', cur_key, '.csv')
          cur_emb <- read.csv(emb_filename) %>%
            rename('ID' = 'X') %>%
            left_join(y = pheno_df %>% select(ID, bigClass), by = 'ID')
          plt <- ggplot(cur_emb) +
            geom_point(aes(x = main.1, y = main.2, color = bigClass)) +
            theme_classic() +
            theme(legend.position = 'bottom')

          plt_path <- './runs/EX04_05/plots/main_lat'
          system(paste0('mkdir -p ', plt_path))
          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)
        }
      }
    })
```

```{r bigClass plots}
try({
      keys_to_plot <- c("bigClass_train_all_latent", "bigClass_test_all_latent")
      output_width <- 5
      output_height <- 5
      for (i in 77:total_epochs) {
        for (cur_key in keys_to_plot) {
          emb_filename <- paste0(emb_path, '/', i, '_', cur_key, '.csv')
          cur_emb <- read.csv(emb_filename) %>%
            rename('ID' = 'X') %>%
            left_join(y = pheno_df %>% select(ID, bigClass), by = 'ID')
          plt <- ggplot(cur_emb) +
            geom_density(aes(x = bigClass.1, color = bigClass)) +
            geom_density(aes(x = bigClass.1)) +
            theme_classic() +
            theme(legend.position = 'bottom')

          plt_path <- './runs/EX04_05/plots/bigClass_lat'
          system(paste0('mkdir -p ', plt_path))
          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)
        }
      }
    })
```



## 3-D Plots

```{r}
require(plotly)
require(htmlwidgets)
try({
      keys_to_plot <- c("bigClass_train_all_latent", "bigClass_test_all_latent")
      for (i in total_epochs:total_epochs) {
        for (cur_key in keys_to_plot[1]) {
          emb_filename <- paste0(emb_path, '/', i, '_', cur_key, '.csv')
          cur_emb <- read.csv(emb_filename) %>%
            rename('ID' = 'X') %>%
            left_join(y = pheno_df %>% select(ID, bigClass), by = 'ID')
          plt <- plot_ly(cur_emb, x = ~main.1, y = ~main.2, z = ~bigClass.1, color = ~bigClass)


        }
      }
    })

```
