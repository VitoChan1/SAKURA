---
title: "Make run summary plots"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(ggplot2)
require(dplyr)
require(magrittr)
require(ggExtra)
options(stringsAsFactors = FALSE)
getwd()
```

# Configuration

```{r paths}
emb_path <- './runs/EX05_05/logs'
pheno_df_path <- './dataset/PUMC_mouse_cardio/TAC_cell_info_191024.csv'
expr_mat_path <- './dataset/PUMC_mouse_cardio/TAC_cell_umi_191024.csv'
expr_mat_SCT_path <- './dataset/PUMC_mouse_cardio/sctransform_poission_res.csv.gz'
```

# Import Labels

```{r import labels}
pheno_df <- read.csv(pheno_df_path)
expr_mat <- read.csv(expr_mat_path)
expr_sct_mat <- read.csv(expr_mat_SCT_path)
```

# Make Embedding Plots

```{r global configs}
total_epochs <- 120
```

## Main latent plots (main.1 and main.2)


```{r signature latent plots}
try({
      keys_to_plot <- c("overall_test_all_latent", "overall_train_all_latent")
      output_width <- 5
      output_height <- 5
      for (i in 30:total_epochs) {
        for (cur_key in keys_to_plot) {
          emb_filename <- paste0(emb_path, '/', i, '_', cur_key, '.csv')
          cur_emb <- read.csv(emb_filename) %>%
            rename('ID' = 'X') %>%
            left_join(y = pheno_df %>% select(ID, bigClass), by = 'ID')

          plt <- ggplot(cur_emb) +
            geom_point(aes(x = CM.1, y = MP.1, color = bigClass)) +
            theme_classic() +
            theme(legend.position = 'bottom')
          plt <- ggMarginal(plt, groupColour = TRUE, groupFill = TRUE)
          plt_path <- './runs/EX05_05/plots/signature_lat'
          system(paste0('mkdir -p ', plt_path))
          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_CM_MP.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_point(aes(x = CM.1, y = FB.1, color = bigClass)) +
            theme_classic() +
            theme(legend.position = 'bottom')
          plt <- ggMarginal(plt, groupColour = TRUE, groupFill = TRUE)

          system(paste0('mkdir -p ', plt_path))
          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_CM_FB.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_point(aes(x = MP.1, y = EC.1, color = bigClass)) +
            theme_classic() +
            theme(legend.position = 'bottom')
          plt <- ggMarginal(plt, groupColour = TRUE, groupFill = TRUE)
          system(paste0('mkdir -p ', plt_path))
          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_MP_EC.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_point(aes(x = EC.1, y = FB.1, color = bigClass)) +
            theme_classic() +
            theme(legend.position = 'bottom')
          plt <- ggMarginal(plt, groupColour = TRUE, groupFill = TRUE)
          system(paste0('mkdir -p ', plt_path))
          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_EC_FB.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)


        }
      }
    })
```

```{r signature distrib}
try({
      keys_to_plot <- c("overall_test_all_latent", "overall_train_all_latent")
      output_width <- 5
      output_height <- 5
      for (i in 1:total_epochs) {
        for (cur_key in keys_to_plot) {
          emb_filename <- paste0(emb_path, '/', i, '_', cur_key, '.csv')
          cur_emb <- read.csv(emb_filename) %>%
            rename('ID' = 'X') %>%
            left_join(y = pheno_df %>% select(ID, bigClass), by = 'ID')
          plt <- ggplot(cur_emb) +
            geom_density(aes(x = EC.1, color = bigClass)) +
            geom_density(aes(x = EC.1)) +
            theme_classic() +
            theme(legend.position = 'bottom')

          plt_path <- './runs/EX05_05/plots/signature_distrib'
          system(paste0('mkdir -p ', plt_path))
          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_EC.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_density(aes(x = MP.1, color = bigClass)) +
            geom_density(aes(x = MP.1)) +
            theme_classic() +
            theme(legend.position = 'bottom')


          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_MP.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_density(aes(x = FB.1, color = bigClass)) +
            geom_density(aes(x = FB.1)) +
            theme_classic() +
            theme(legend.position = 'bottom')


          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_FB.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_density(aes(x = CM.1, color = bigClass)) +
            geom_density(aes(x = CM.1)) +
            theme_classic() +
            theme(legend.position = 'bottom')


          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_CM.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_density(aes(x = T.1, color = bigClass)) +
            geom_density(aes(x = T.1)) +
            theme_classic() +
            theme(legend.position = 'bottom')


          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_T.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_density(aes(x = main.1, color = bigClass)) +
            geom_density(aes(x = main.1)) +
            theme_classic() +
            theme(legend.position = 'bottom')


          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_main_1.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

          plt <- ggplot(cur_emb) +
            geom_density(aes(x = main.2, color = bigClass)) +
            geom_density(aes(x = main.2)) +
            theme_classic() +
            theme(legend.position = 'bottom')


          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_main_2.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)
          plt <- ggplot(cur_emb) +
            geom_density(aes(x = GN.1, color = bigClass)) +
            geom_density(aes(x = GN.1)) +
            theme_classic() +
            theme(legend.position = 'bottom')


          plt_filename <- paste0(plt_path, '/', i, '_', cur_key, '_GN.jpg')

          ggsave(plt, filename = plt_filename, width = output_width, height = output_height)

        }
      }
    })
```



## 3-D Plots

```{r}
require(plotly)
require(htmlwidgets)
try({
      keys_to_plot <- c("bigClass_train_all_latent", "bigClass_test_all_latent")
      for (i in total_epochs:total_epochs) {
        for (cur_key in keys_to_plot[1]) {
          emb_filename <- paste0(emb_path, '/', i, '_', cur_key, '.csv')
          cur_emb <- read.csv(emb_filename) %>%
            rename('ID' = 'X') %>%
            left_join(y = pheno_df %>% select(ID, bigClass), by = 'ID')
          plt <- plot_ly(cur_emb, x = ~main.1, y = ~main.2, z = ~bigClass.1, color = ~bigClass)


        }
      }
    })

```
